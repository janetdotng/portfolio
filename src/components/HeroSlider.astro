---
const slides = [
  {
    bg: "#aeb7ac",
    title: "Motion Graphics",
    link: "/showcase?group=motiongraphics",
    media: [
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_600/v1771602186/slide1-left_m83yus"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_900/v1771602196/slide1-center_hobovn"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_600/v1771602180/slide1-right_e60rvk"
      }
    ]
  },
  {
    bg: "#8fa2b5",
    title: "Graphic Design",
    link: "/showcase?group=graphicdesign",
    media: [
      {
        type: "video",
        src: "https://res.cloudinary.com/dwj5kjslu/video/upload/f_auto,q_auto,w_600/v1771605614/slide2-left_jsu3wr"
      },
      {
        type: "video",
        src: "https://res.cloudinary.com/dwj5kjslu/video/upload/f_auto,q_auto,w_900/v1771605785/slide2-center_hoxzyz"
      },
      {
        type: "video",
        src: "https://res.cloudinary.com/dwj5kjslu/video/upload/f_auto,q_auto,w_600/v1771605719/slide2-right_qrwz87"
      }
    ]
  },
  {
    bg: "#bfa089",
    title: "Commercial Works",
    link: "/showcase?group=commercialworks",
    media: [
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_600/v1771602174/slide3-left_hpoxon"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_900/v1771602189/slide3-center_hlvobz"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_600/v1771602180/slide3-right_n4gqzk"
      }
    ]
  }
];
---

<section class="hero">
  <div class="slider" id="slider">
    {slides.map((slide) => (
      <div
        class="panel"
        data-bg={slide.bg}
        data-title={slide.title}
        data-link={slide.link}
      >
        <a href={slide.link} class="card-link">
          <div class="visual-set">

            <div class="side left-wrap">
              {slide.media[0].type === "video" ? (
                <video autoplay muted loop playsinline preload="auto" disablepictureinpicture>
                  <source src={slide.media[0].src} type="video/mp4" />
                </video>
              ) : (
                <img src={slide.media[0].src} loading="eager" draggable="false" />
              )}
            </div>

            <div class="centre-wrap">
              {slide.media[1].type === "video" ? (
                <video autoplay muted loop playsinline preload="auto" disablepictureinpicture>
                  <source src={slide.media[1].src} type="video/mp4" />
                </video>
              ) : (
                <img src={slide.media[1].src} loading="eager" draggable="false" />
              )}
            </div>

            <div class="side right-wrap">
              {slide.media[2].type === "video" ? (
                <video autoplay muted loop playsinline preload="auto" disablepictureinpicture>
                  <source src={slide.media[2].src} type="video/mp4" />
                </video>
              ) : (
                <img src={slide.media[2].src} loading="eager" draggable="false" />
              )}
            </div>

          </div>
        </a>
      </div>
    ))}
  </div>

  <div class="title-layer">
    <h2 id="dynamicTitle"></h2>
  </div>

  <div class="progress-track">
    <div class="progress-bar"></div>
  </div>

  <div class="side-nav">
    <button id="upBtn">↑</button>
    <button id="downBtn">↓</button>
  </div>
</section>

<script is:inline>
const slider = document.getElementById("slider");
let panels = Array.from(document.querySelectorAll(".panel"));
const total = panels.length;

let current = 1;
let offset = 0;
let wheelLock = false;
let autoInterval;
const autoplayDelay = 7000;

const dynamicTitle = document.getElementById("dynamicTitle");
const progressBar = document.querySelector(".progress-bar");
const upBtn = document.getElementById("upBtn");
const downBtn = document.getElementById("downBtn");

const firstClone = panels[0].cloneNode(true);
const lastClone = panels[total - 1].cloneNode(true);

slider.appendChild(firstClone);
slider.insertBefore(lastClone, slider.firstChild);

panels = Array.from(document.querySelectorAll(".panel"));

function updatePosition(animate = true) {
  slider.style.transition = animate
    ? "transform 0.7s cubic-bezier(.22,1,.36,1)"
    : "none";

  slider.style.transform =
    `translateY(${-current * window.innerHeight}px)`;
}

function fixLoop() {
  if (current === 0) {
    slider.style.transition = "none";
    current = total;
    updatePosition(false);
  }
  if (current === total + 1) {
    slider.style.transition = "none";
    current = 1;
    updatePosition(false);
  }
}

function setActiveContent() {
  const active = panels[current];
  const bg = active.dataset.bg;
  const title = active.dataset.title;

  dynamicTitle.style.opacity = "0";

  setTimeout(() => {
    dynamicTitle.textContent = title;
    dynamicTitle.style.opacity = "1";
  }, 200);

  document.body.style.backgroundColor = bg;
}

function goNext() {
  if (wheelLock) return;
  wheelLock = true;

  current++;
  setActiveContent();
  updatePosition(true);

  setTimeout(() => {
    fixLoop();
    wheelLock = false;
  }, 700);

  restartAutoplay();
}

function goPrev() {
  if (wheelLock) return;
  wheelLock = true;

  current--;
  setActiveContent();
  updatePosition(true);

  setTimeout(() => {
    fixLoop();
    wheelLock = false;
  }, 700);

  restartAutoplay();
}

upBtn.onclick = goPrev;
downBtn.onclick = goNext;

function startAutoplay() {
  autoInterval = setInterval(goNext, autoplayDelay);
}

function restartAutoplay() {
  clearInterval(autoInterval);
  startAutoplay();
}

updatePosition(false);
setActiveContent();
startAutoplay();
</script>

<style>
.centre-wrap video,
.side video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
</style>