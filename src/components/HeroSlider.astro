---
const slides = [
  {
    bg: "#aeb7ac",
    title: "Motion Graphics",
    link: "/showcase?group=motiongraphics",
    media: [
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_900/v1771602186/slide1-left_m83yus.jpg"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_1600/v1771602196/slide1-center_hobovn.jpg"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_900/v1771602180/slide1-right_e60rvk.jpg"
      }
    ]
  },
  {
    bg: "#8fa2b5",
    title: "Graphic Design",
    link: "/showcase?group=graphicdesign",
    media: [
      {
        type: "video",
        src: "https://res.cloudinary.com/dwj5kjslu/video/upload/f_auto,q_auto,w_900/v1771605614/slide2-left_jsu3wr.mp4"
      },
      {
        type: "video",
        src: "https://res.cloudinary.com/dwj5kjslu/video/upload/f_auto,q_auto,w_1600/v1771605785/slide2-center_hoxzyz.mp4"
      },
      {
        type: "video",
        src: "https://res.cloudinary.com/dwj5kjslu/video/upload/f_auto,q_auto,w_900/v1771605719/slide2-right_qrwz87.mp4"
      }
    ]
  },
  {
    bg: "#bfa089",
    title: "Commercial Works",
    link: "/showcase?group=commercialworks",
    media: [
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_900/v1771602174/slide3-left_hpoxon.jpg"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_1600/v1771602189/slide3-center_hlvobz.jpg"
      },
      {
        type: "image",
        src: "https://res.cloudinary.com/dwj5kjslu/image/upload/f_auto,q_auto,w_900/v1771602180/slide3-right_n4gqzk.jpg"
      }
    ]
  }
];
---

<section class="hero">
  <div class="slider" id="slider">
    {slides.map((slide, slideIndex) => (
      <div
        class="panel"
        data-bg={slide.bg}
        data-title={slide.title}
        data-link={slide.link}
      >
        <a href={slide.link} class="card-link">
          <div class="visual-set">

            {slide.media.map((item, i) => (
              <div class={i === 1 ? "centre-wrap" : `side ${i === 0 ? "left-wrap" : "right-wrap"}`}>
                {item.type === "video" ? (
                  <video
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="auto"
                  >
                    <source src={item.src} type="video/mp4" />
                  </video>
                ) : (
                  <img
                    src={item.src}
                    loading={slideIndex === 0 ? "eager" : "lazy"}
                    fetchpriority={slideIndex === 0 ? "high" : "auto"}
                    draggable="false"
                  />
                )}
              </div>
            ))}

          </div>
        </a>
      </div>
    ))}
  </div>

  <div class="title-layer">
    <h2 id="dynamicTitle"></h2>
  </div>

  <div class="side-nav">
    <button id="upBtn">↑</button>
    <button id="downBtn">↓</button>
  </div>
</section>

<script is:inline>
const slider = document.getElementById("slider");
let panels = Array.from(document.querySelectorAll(".panel"));
const total = panels.length;

let current = 0;
let autoInterval;
const autoplayDelay = 7000;

const dynamicTitle = document.getElementById("dynamicTitle");
const upBtn = document.getElementById("upBtn");
const downBtn = document.getElementById("downBtn");

function updatePosition(animate = true) {
  if (!slider) return;
  slider.style.transition = animate
    ? "transform 0.7s cubic-bezier(.22,1,.36,1)"
    : "none";

  slider.style.transform =
    `translateY(${-current * window.innerHeight}px)`;
}

function setActiveContent() {
  const active = panels[current];
  if (!active || !dynamicTitle) return;

  const bg = active.getAttribute("data-bg");
  const title = active.getAttribute("data-title");

  dynamicTitle.style.opacity = "0";

  setTimeout(() => {
    dynamicTitle.textContent = title || "";
    dynamicTitle.style.opacity = "1";
  }, 200);

  document.body.style.backgroundColor = bg || "#000";
}

function preloadNextSlide() {
  const nextIndex = (current + 1) % total;
  const nextPanel = panels[nextIndex];
  if (!nextPanel) return;

  const media = nextPanel.querySelectorAll("img, video");

  media.forEach(el => {
    if (el.tagName === "VIDEO") {
      el.load();
    } else {
      const img = new Image();
      img.src = el.src;
    }
  });
}

function goNext() {
  current = (current + 1) % total;
  setActiveContent();
  updatePosition(true);
  preloadNextSlide();
  restartAutoplay();
}

function goPrev() {
  current = (current - 1 + total) % total;
  setActiveContent();
  updatePosition(true);
  preloadNextSlide();
  restartAutoplay();
}

upBtn && (upBtn.onclick = goPrev);
downBtn && (downBtn.onclick = goNext);

function startAutoplay() {
  autoInterval = setInterval(goNext, autoplayDelay);
}

function restartAutoplay() {
  clearInterval(autoInterval);
  startAutoplay();
}

updatePosition(false);
setActiveContent();
startAutoplay();
preloadNextSlide();
</script>